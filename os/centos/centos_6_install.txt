super-local.1mobile.com的配置：
1.改root位置
2.forbidden是因为后面没有加index.php
在
location	/里加	index	index.php
3.The configuration file does not exist.
cp config.online.php config.php后
报500错误，查看 /var/log/php-fpm/www-error.log得知是smarty模板文件夹无写权限。
4.mkdir -m 777 /home/jimmychou/workspace/1mobile/super/application/views/templates_c
5.登录进去是500，需要
cp database-online.php database.php，但最好把库名从	cms_1mobile	改为	test_1mobile
通过这5步，super在虚拟机上的开发环境搭建完成。

sudo yum install memcached subversion phpmyadmin

nginx配置phpmyadmin段location，包括php和css等
更改phpmyadmin配置文件
$cfg['blowfish_secret'] = 'abcdefghijklmn';
加一个blowfish_secret即可
此时可用root登录
用jimmychou用户登录需要
GRANT CREATE,DROP,ALTER,SELECT,INSERT,UPDATE,DELETE ON test.* TO 'jimmychou'@'localhost' IDENTIFIED BY 'penny7531';
GRANT CREATE,DROP,ALTER,SELECT,INSERT,UPDATE,DELETE ON employees.* TO 'jimmychou'@'localhost' IDENTIFIED BY 'penny7531';

ALTER DATABASE `test` DEFAULT CHARACTER SET latin1 COLLATE latin1_general_ci;
ALTER DATABASE `employees` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
ALTER DATABASE `test` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;

drop database employees;
drop database test;

CREATE DATABASE `jimmychou` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
GRANT CREATE,DROP,ALTER,SELECT,INSERT,UPDATE,DELETE ON jimmychou.* TO 'jimmychou'@'localhost' IDENTIFIED BY 'penny7531';

ALTER DATABASE `jimmychou` DEFAULT CHARACTER SET latin1 COLLATE latin1_general_ci;
ALTER DATABASE `jimmychou` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;

 CREATE TABLE `jimmychou`.`jimmychou` (
`id` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT '主键',
`name` VARCHAR( 40 ) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL
COMMENT '名称',
UNIQUE (
`name`
)
) ENGINE = MYISAM CHARACTER SET utf8 COLLATE utf8_general_ci COMMENT = 'jimmychou的测试表' 

插入一条数据后

ALTER TABLE `jimmychou` ENGINE = InnoDB; 

wget https://fastdfs.googlecode.com/files/FastDFS_v4.06.tar.gz
tar -zvxf FastDFS_v4.06.tar.gz
cd FastDFS
./make.sh
sudo ./make.sh install

初次配置gomarket环境：

configure: WARNING: You will need re2c 0.13.4 or later if you want to regenerate PHP parsers

wget http://sourceforge.net/projects/re2c/files/re2c/0.13.5/re2c-0.13.5.tar.gz
tar -zxvf re2c-0.13.5.tar.gz
cd re2c-0.13.5
./configure && make && make install


php-memcached-1.0.0编译安装时出现问题

错误：libmemcached-1.0/memcached.h：没有那个文件或目录
建个软链，sudo ln -s /usr/include/libmemcached/ /usr/include/libmemcached-1.0
zend_class_entry’没有名为‘default_prope
到这步报错“php_gearman.c:3630:错误：’zend_class_entry’没有名为’default_properties’成员”
解决：替换php_memcached.c文件中的default_properties为default_properties_table

最好不要多个软件版本混在一起，尤其是build出来的，否则容易混乱，各种奇怪的问题发生：

sudo yum erase httpd nginx mysql mysql-server php php-pecl-memcache php-gd php-pear phpmyadmin php-mcrypt php-common php-cli php-pdo php-mbstring php-mysql memcached libmemcached-devel libmemcache-devel libmemcached libmemcache httpd-tools gmp-devel cyrus-sasl-plain cyrus-sasl-devel cyrus-sasl-gssapi cyrus-sasl-md5
sudo rm -fr /etc/httpd /etc/nginx /usr/share/nginx /usr/lib/mysql /usr/share/mysql

[jimmychou@localhost ~]$ rpm-qa | grep mysql      
mysql-libs-5.1.73-3.el6_5.i686

这个不能再卸载了


再次配置gomarket环境：

build安装nginx,mysql,memcached,php




sudo yum install libmemcached只装php-memcached没用，其基础库是libmemcached
安装后连controller都进不去，是在哪里卡住了呢？这套程序的最大问题就是不知道程序走到哪里了，需要哪些扩展。原来是没有安装nginx，而且mysql,httpd也均未安装，只是之前试着安装了一个php
~/workspace/jimmy/shell/build.sh
nginxGPERFTOOLSVERSION=2.1从改为2.0加上CentOS6.5的分支，
并且sudo yum install
perl perl-devel
perl-ExtUtils-Embed在用build.sh编译安装PHP之前：[jimmychou@localhost
newgomarket.goapk.com]$ whereis phpphp: /usr/local/bin/php
/usr/local/lib/php.ini /usr/local/lib/php
/usr/local/php==及=,],[前后均必须加空格,变量如要保证为空及含空格的多个单词时不出错就要加双引号.不加空格虽然不报错,语义也是错的.两次build混合安装的！！
[jimmychou@localhost~]$ whereis php
php: /usr/bin/php /etc/php.d /usr/local/bin/php /usr/local/lib/php.ini /usr/local/lib/php /usr/include/php /usr/local/php /usr/share/man/man1/php.1

[jimmychou@localhost ~]$whereis php
php: /usr/bin/php /etc/php.d /usr/include/php /usr/share/man/man1/php.1

extension=/usr/lib/20121212/curl.so
extension=/usr/lib/20121212/json.so
调试半天，发现始终是登录错误，原来是nginx服务并没有开启：
下面是开启服务：
sudo -p mkdir /etc/nginx/conf.d
sudo cp ~/workspace/jimmy/os/centos/build/build_as_system/conf/nginx/nginx.conf /etc/nginx/
sudo cp ~/workspace/jimmy/os/centos/build/build_as_system/conf/nginx/conf.d/centos_6.conf /etc/nginx/conf.d/
sudo /sbin/ldconfig -v没有/usr/local/lib目录使用ldconfig命令将/usr/local/lib加入到默认库，
echo "/usr/local/lib" >>/etc/ld.so.conf，或者直接加/usr/local/lib在上述文件尾部/sbin/ldconfig去更新


原来是php-fpm在编译时没有fpm-enable看到7月11日而今天是7月21日居然不怀疑！！
sudo cp ~/workspace/jimmy/os/centos/build/build_as_system/conf/php/* /etc/

（也可从原生配置sudo cp ~/software/php-5.5.14/sapi/fpm/php-fpm.conf /etc/php-fpm.conf或者是sudo cp /etc/php-fpm.conf.default /etc/php-fpm.conf）

此时从页面访问完全没问题了，但是命令行执行测试脚本还报502，报错如下：
recv() failed (104: Connection reset by peer) while reading response header from upstream
[22-Jul-2014 10:59:46] WARNING: [pool www] child 2565 exited on signal 11 (SIGSEGV) after 27.894244 seconds from start
[22-Jul-2014 10:59:46] NOTICE: [pool www] child 2624 started
[22-Jul-2014 11:00:23] WARNING: [pool www] child 2566 exited on signal 11 (SIGSEGV) after 64.728058 seconds from start
[22-Jul-2014 11:00:23] NOTICE: [pool www] child 2633 started
也即php-fpm进程频繁挂掉和重启

在网上搜到一个解决办法：
修改php-fpm配置，只起一个worker进程
kill -USR2 `cat /var/run/php-fpm.pid` 重启php-fpm
sudo yum install strace
strace -p `cat /var/run/php-fpm.pid`
/*
然后发现php worker进程在connect某个端口后就挂掉了
一问L同学这个端口是干嘛的，然后他恍然大悟，哦。。。。。。
原因是没有对redis的pconnect的返回值做判断，然后直接lpush，导致php worker进程直接core掉。
*/

从/var/log/message得知是segfault，后来写了个简单的PHP脚本测试，居然是php连接memcached时出现segfault
sudo yum install gdb，打算用coredump调试，但最后实在搞不定，放弃这样调试

将php-fpm的进程数到最小即2后
写了一个简单脚本，测试似乎并不是简单环境的原因，可能跟数据库，Memcached等连接报错有关，于是乎，去具体的应用逻辑代码去定位。果然，在controller的开头是正确返回的，定位在$result = $ucenterModel->do_uc_login_request($data,true);里面。

然后继续定位在$cache = GoCache::getCacheAdapter('memcached');

GoCache::getCacheAdapter的$adapter = new $adapterClassName($config);
也即new Memcached();产生段错误。

难道是因为安装扩展时没有指定memcached安装路径？还是因为版本1.0.0的问题？但是之后的版本编译不能通过啊！

At present memcached-1.0.0 does not compile with libmemcached-0.38
Solved it by using this combination:
libmemcached release 1.0.16 - installed from source
php-memcached release 2.1.0 - installed from source & Added memcached.so in php.in
I Hope this help.

安装前查看扩展
-rwxr-xr-x 1 root root  137601 7月  21 15:37 memcached.so

wget https://launchpad.net/libmemcached/1.0/1.0.16/+download/libmemcached-1.0.16.tar.gz
sudo yum erase libmemcached-devel libmemcached
cd ~/libmemcached-1.0.16
./configure
make
sudo make install

cd ~/memcached-2.1.0
./configure
make
sudo make install
安装之后
-rwxr-xr-x 1 root root  231853 7月  22 16:45 memcached.so
果然还是不一样
终于不会段错误了！！

但是502依旧存在，把php-fpm进程数从2调到20就管用了，至少在接口的这个位置通过了，但是整个接口还是不能走通，仍然是502.继续调试：

登录错误，定位在
$channel = $this->findOne($option);
ctrl+]经常跳错
然后定位在
GoModel::getDb的语句 GoDB::getServerDriver($server) 上
然后定位在 GoDB::getServerDriver($server)的语句$driver->connect($dbConfig);上
@mysql_connect导致不报错，打开后报错
Call to undefined function mysql_connect()

原来是php.ini没有加入mysql.so扩展
加入后重启php-fpm（因为是curl访问）

Call to undefined function mcrypt_module_open() 
重新编译PHP，configure时加上--with-mcrypt
并且在php.ini加上，然后重启php-fpm


测试softcatelog时报错
Class 'Redis' not found in <b>/home/jimmychou/workspace/goapk/trunk/GoPHP/lib/GoRedisCacheAdapter.class.php
cd ~
git clone https://github.com/owlient/phpredis.git
cp -r phpredis software/
phpize
./configure
make
sudo make install


刚刚测试还没报错，这时又出现一个错误如下，看来这是上次测试之后修改代码后才冒出来的问题：
Call to undefined function mb_convert_encoding() in <b>/home/jimmychou/workspace/goapk/trunk/GoPHP/lib/Common.func.php</b
mbstring.so加入php.ini并重启php-fpm

加入php.ini并重启php-fpm后再测试是504，但是过一会儿又好了，看来这只是网络的问题。

php-fpm进程数开到3个就合适，不会出现502，甚至改成1个进程但是static也不会产生502，这是为何？
当dynamic时，pm.max_children = 1而pm.start_servers = 2时必然会502！因为此时根本就没有php-fpm进程，服务没有启动成功。
pm.max_children = 1
pm.max_children = 2

[jimmychou@localhost ~]$ sudo /usr/sbin/php-fpm 
[23-Jul-2014 09:35:45] ALERT: [pool www] pm.min_spare_servers(1) and pm.max_spare_servers(3) cannot be greater than pm.max_children(2)
[23-Jul-2014 09:35:45] ERROR: failed to post process the configuration
[23-Jul-2014 09:35:45] ERROR: FPM initialization failed

pm.max_children = 3时OK，但这个数目不包括mater进程，起初只有两个进程是由pm.start_servers = 2决定的。

终于不再502了，但是第一次执行php loginnew.php gomarket.goapk.com会比较慢。
如果今后再出现502，不妨将此值设高后重启php-fpm试试。

设为开机启动 ：
sudo cp ~/workspace/jimmy/os/centos/build/build_as_system/init.d/nginx /etc/init.d/nginx
sudo cp ~/workspace/jimmy/os/centos/build/build_as_system/init.d/php-fpm /etc/init.d/php-fpm

sudo chkconfig --add nginx
sudo chkconfig --add php-fpm
sudo chkconfig nginx on
sudo chkconfig php-fpm on

总结一下：
502先后由PHP扩展出现段错误，数据库连接报错被隐藏等排查很久。
504则基本是网络超时问题。

测试安卓游戏LOGIN_NEW接口时遇到问题：
先是500看/var/log/nginx/yx.error.log
是没有GoPHP库，复制到相关目录后
然后是task.helper.php里GearmanClient类未定义的报错。
要先装libgearman
yum search libgearman找不到
http://pecl.php.net/package/gearman
下载gearman-1.0.0编译安装。
configure: error: Couldn't find uuid/uuid.h. Try installing libuuid
development packages
sudo yum install libuuid-devel
[jimmychou@localhost gearmand-0.21]
configure: error: cannot find Boost headers version >= 1.39.0

sudo yum install boost-devel(1.41.0)后再编译gearmand-0.21通过
装php扩展
[jimmychou@localhost gearman-1.0.0]$ sudo make install
Installing shared extensions:     /usr/lib/20121212/
将gearman.so加入php.ini并重启php-fpm

sudo vmware-toolbox-cmd disk list
sudo vmware-toolbox-cmd disk shrinkonly不管用啊
sudo vmware-toolbox-cmd disk shrink /
sudo vmware-toolbox-cmd disk shrink /boot管用

mount /dev/cdrom /mnt/cdrom，此命令会报错，无视
cp /mnt/VMwareTools-9.2.3-1031360.tar.gz ~
sudo ./vm

5.52G(off)->6.02G(on)->4.97G(on after shrink /)->3.7G(df -lh)->4.2G(df -lh after install vmtools，vmtools安装后就自动同步时间了，再也不用ntpdate cn.pool.ntp.org了。)->4.47G(off)
各种clean,rm后
3.0G(df -lh)->4.97G(on)->3.77G(on after shrink /)->3.27(off)

清理内核文件
[jimmychou@localhost boot]$ ll /boot/
-rwxr-xr-x  1 root root  4002240 1月   4 2014 vmlinuz-2.6.32-431.3.1.el6.i686
[jimmychou@localhost boot]$ rpm -qa | grep 2.6.32-431.3.1
kernel-2.6.32-431.3.1.el6.i686

sudo yum erase kernel-2.6.32-431.3.1.el6.i686 kernel-2.6.32-431.5.1.el6.i686
kernel-2.6.32-431.11.2.el6.i686 kernel-2.6.32-431.17.1.el6.i686

3.0G(df -lh)->4.14G(on)->3.77G(on after shrink /)->3.68G(on after shrink /boot)->3.18G(off，此时USED=3.0G，这180M去哪里了？)

XShell颜色设置 :
在XShell的工具->配色方案导入solarized-dark.xcs
然后把下面的文本加入后~/.bash_profile，在命令行执行 source
~/.bash_profile即可。
alias ls='ls --color=auto'
LS_COLORS='no=00:fi=00:di=00;34:ln=00;36:pi=40;33:so=00;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:mi=01;05;37;41:ex=00;32:*.cmd=00;32:*.exe=00;32:*.com=00;32:*.btm=00;32:*.bat=00;32:*.sh=00;32:*.csh=00;32:*.tar=00;31:*.tgz=00;31:*.arj=00;31:*.taz=00;31:*.lzh=00;31:*.zip=00;31:*.z=00;31:*.Z=00;31:*.gz=00;31:*.bz2=00;31:*.bz=00;31:*.tz=00;31:*.rpm=00;31:*.cpio=00;31:*.jpg=00;35:*.gif=00;35:*.bmp=00;35:*.xbm=00;35:*.xpm=00;35:*.png=00;35:*.tif=00;35:'
export LS_COLORS

清除得还不彻底
cd /usr/local/bin && sudo rm -f pear pecl

xhprof:
cd ~ && wget http://pecl.php.net/get/xhprof-0.9.4.tgz
tar -zvxf xhprof-0.9.4.tgz
cd ~/xhprof-0.9.4/extension && phpize && ./configure && make && sudo make install
将此扩展加入php.ini
后来发现此模块会导致new GoDes发生段错误，不得不弃之。

安装tcpdump
sudo yum install tcpdump

安装redis
sudo yum install tcl-devel
否则会
[jimmychou@localhost redis-2.8.13]$ sudo make test
cd src && make test
make[1]: Entering directory `/home/jimmychou/software/redis-2.8.13/src'
You need tcl 8.5 or newer in order to run the Redis test
make[1]: *** [test] 错误 1
make[1]: Leaving directory `/home/jimmychou/software/redis-2.8.13/src'
make: *** [test] 错误 2

sudo make PREFIX=/usr install
即把redis-benchmark redis-check-aof redis-check-dump    redis-cli   redis-server这五个命令安装在/usr/bin下面
